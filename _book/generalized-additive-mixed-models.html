<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Generalized Additive Mixed Models | Statistics Tips</title>
  <meta name="description" content="This book contains statistics and R tips." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Generalized Additive Mixed Models | Statistics Tips" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book contains statistics and R tips." />
  <meta name="github-repo" content="LCBC-UiO/LCBC-Stats-Tips" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Generalized Additive Mixed Models | Statistics Tips" />
  
  <meta name="twitter:description" content="This book contains statistics and R tips." />
  

<meta name="author" content="Øystein Sørensen" />


<meta name="date" content="2022-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="generalized-additive-mixed-models.html"><a href="generalized-additive-mixed-models.html"><i class="fa fa-check"></i><b>2</b> Generalized Additive Mixed Models</a>
<ul>
<li class="chapter" data-level="2.1" data-path="generalized-additive-mixed-models.html"><a href="generalized-additive-mixed-models.html#scannerbatch-effects"><i class="fa fa-check"></i><b>2.1</b> Scanner/batch effects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics Tips</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="generalized-additive-mixed-models" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Generalized Additive Mixed Models</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="generalized-additive-mixed-models.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.6     ✓ dplyr   1.0.7
## ✓ tidyr   1.1.4     ✓ stringr 1.4.0
## ✓ readr   2.1.1     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="generalized-additive-mixed-models.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb5-2"><a href="generalized-additive-mixed-models.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## 
## Attaching package: &#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<pre><code>## This is mgcv 1.8-38. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<p>The utility of GAMMs for estimating lifespan brain trajectories is described in <span class="citation"><a href="#ref-fjell2010" role="doc-biblioref">Fjell et al.</a> (<a href="#ref-fjell2010" role="doc-biblioref">2010</a>)</span> and <span class="citation"><a href="#ref-sorensen2021" role="doc-biblioref">Sørensen, Walhovd, and Fjell</a> (<a href="#ref-sorensen2021" role="doc-biblioref">2021</a>)</span>. The main R packages for GAMMs are <code>mgcv</code> and <code>gamm4</code>.</p>
<div id="scannerbatch-effects" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Scanner/batch effects</h2>
<p>A common problem is that longitudinal data have been collected on different scanners. There can be systematic differences between values estimated on different scanners, and they can have different noise levels. We will simulate some data to illustrate the problem.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="generalized-additive-mixed-models.html#cb10-1" aria-hidden="true" tabindex="-1"></a>scanners <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb10-2"><a href="generalized-additive-mixed-models.html#cb10-2" aria-hidden="true" tabindex="-1"></a>scanner_bias <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">4</span>, .<span class="dv">2</span>)</span>
<span id="cb10-3"><a href="generalized-additive-mixed-models.html#cb10-3" aria-hidden="true" tabindex="-1"></a>scanner_noise <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, .<span class="dv">5</span>)</span>
<span id="cb10-4"><a href="generalized-additive-mixed-models.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(scanner_bias) <span class="ot">&lt;-</span> <span class="fu">names</span>(scanner_noise) <span class="ot">&lt;-</span> scanners</span>
<span id="cb10-5"><a href="generalized-additive-mixed-models.html#cb10-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb10-6"><a href="generalized-additive-mixed-models.html#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="generalized-additive-mixed-models.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9988</span>)</span>
<span id="cb10-8"><a href="generalized-additive-mixed-models.html#cb10-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb10-9"><a href="generalized-additive-mixed-models.html#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">seq_len</span>(n), </span>
<span id="cb10-10"><a href="generalized-additive-mixed-models.html#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">0</span>,</span>
<span id="cb10-11"><a href="generalized-additive-mixed-models.html#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">random_intercept =</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb10-12"><a href="generalized-additive-mixed-models.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="generalized-additive-mixed-models.html#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_observations =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="generalized-additive-mixed-models.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(num_observations) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="generalized-additive-mixed-models.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="generalized-additive-mixed-models.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timepoint =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="generalized-additive-mixed-models.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-18"><a href="generalized-additive-mixed-models.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-19"><a href="generalized-additive-mixed-models.html#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">if_else</span>(timepoint <span class="sc">==</span> <span class="dv">1</span>, time, <span class="fu">runif</span>(<span class="fu">nrow</span>(.), <span class="at">max =</span> .<span class="dv">5</span>)),</span>
<span id="cb10-20"><a href="generalized-additive-mixed-models.html#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">scanner =</span> <span class="fu">factor</span>(<span class="fu">sample</span>(scanners, <span class="at">size =</span> <span class="fu">nrow</span>(.), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-21"><a href="generalized-additive-mixed-models.html#cb10-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-22"><a href="generalized-additive-mixed-models.html#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb10-23"><a href="generalized-additive-mixed-models.html#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">cumsum</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a href="generalized-additive-mixed-models.html#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="generalized-additive-mixed-models.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-26"><a href="generalized-additive-mixed-models.html#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="at">sd =</span> scanner_noise[scanner]),</span>
<span id="cb10-27"><a href="generalized-additive-mixed-models.html#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">bias =</span> scanner_bias[scanner],</span>
<span id="cb10-28"><a href="generalized-additive-mixed-models.html#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fl">0.2</span> <span class="sc">*</span> time<span class="sc">^</span><span class="dv">11</span> <span class="sc">*</span> (<span class="dv">10</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> time))<span class="sc">^</span><span class="dv">6</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> </span>
<span id="cb10-29"><a href="generalized-additive-mixed-models.html#cb10-29" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">10</span> <span class="sc">*</span> time)<span class="sc">^</span><span class="dv">3</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> time)<span class="sc">^</span><span class="dv">10</span> <span class="sc">+</span> bias <span class="sc">+</span> noise <span class="sc">+</span> random_intercept</span>
<span id="cb10-30"><a href="generalized-additive-mixed-models.html#cb10-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-31"><a href="generalized-additive-mixed-models.html#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise, <span class="sc">-</span>bias, <span class="sc">-</span>timepoint)</span></code></pre></div>
<p>Here is a spaghetti plot of the data.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="generalized-additive-mixed-models.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> y, <span class="at">group =</span> id)) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="generalized-additive-mixed-models.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="generalized-additive-mixed-models.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> scanner))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>There are two ways of correcting for scanner bias. We can either include scanner as a fixed effect, or we can include it as a random effect. With as few as 4 scanners this will not make much of a difference in practice, but the interpretations of the models are a bit difference. With <em>fixed effects</em> we are interested in the specific scanners in this study, and want to estimater <em>their</em> bias. With <em>random effects</em> we would consider scanners as samples from some population of scanners, and our interest would be in the variation between scanners. Given the limited number of scanners, we use fixed effects in this example.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="generalized-additive-mixed-models.html#cb12-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(y <span class="sc">~</span> <span class="fu">s</span>(time) <span class="sc">+</span> scanner, <span class="at">random =</span> <span class="fu">list</span>(<span class="at">id =</span><span class="sc">~</span> <span class="dv">1</span>), <span class="at">data =</span> dat)</span></code></pre></div>
<p>We can plot the model fit.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="generalized-additive-mixed-models.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1<span class="sc">$</span>gam)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>And inspect the output. We that the <code>scanner</code> term has discovered that there are systematic differences between the scanners. It won’t be exact, since this is a randoom sample, but it points in the right directions.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="generalized-additive-mixed-models.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1<span class="sc">$</span>gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## y ~ s(time) + scanner
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  2.36789    0.07091  33.392   &lt;2e-16 ***
## scannerb     0.98792    0.09460  10.443   &lt;2e-16 ***
## scannerc     0.14460    0.09211   1.570   0.1166    
## scannerd     0.16303    0.09376   1.739   0.0822 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df    F p-value    
## s(time) 8.795  8.795 1100  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.775   
##   Scale est. = 1.6241    n = 2026</code></pre>
<p>The model does however assume identical residuals, regardless of scanner. We can produce a diagnostic plot showing the residuals by scanner, which shows that this assumption is not correct (as we already new). In particular, scanner d has much lower residuals than scanner c.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="generalized-additive-mixed-models.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1<span class="sc">$</span>lme, <span class="at">form =</span> <span class="fu">resid</span>(.) <span class="sc">~</span> <span class="fu">fitted</span>(.) <span class="sc">|</span> scanner)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>We can allow the residual standard deviation to differ between scanners.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="generalized-additive-mixed-models.html#cb17-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(y <span class="sc">~</span> <span class="fu">s</span>(time) <span class="sc">+</span> scanner, <span class="at">random =</span> <span class="fu">list</span>(<span class="at">id =</span><span class="sc">~</span> <span class="dv">1</span>), </span>
<span id="cb17-2"><a href="generalized-additive-mixed-models.html#cb17-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span>  <span class="sc">|</span> scanner), <span class="at">data =</span> dat)</span></code></pre></div>
<p>Looking at the model output, under <code>Variance function:</code>, we see the multipliers for each scanner.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="generalized-additive-mixed-models.html#cb18-1" aria-hidden="true" tabindex="-1"></a>mod2<span class="sc">$</span>lme</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: strip.offset(mf) 
##   Log-likelihood: -3574.53
##   Fixed: y.0 ~ X - 1 
## X(Intercept)    Xscannerb    Xscannerc    Xscannerd  Xs(time)Fx1 
##    2.3640655    0.9799803    0.1639192    0.1511269    2.3047793 
## 
## Random effects:
##  Formula: ~Xr - 1 | g
##  Structure: pdIdnot
##              Xr1      Xr2      Xr3      Xr4      Xr5      Xr6      Xr7      Xr8
## StdDev: 24.80835 24.80835 24.80835 24.80835 24.80835 24.80835 24.80835 24.80835
## 
##  Formula: ~1 | id %in% g
##         (Intercept) Residual
## StdDev:    1.038648 1.036847
## 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | scanner 
##  Parameter estimates:
##         a         b         c         d 
## 1.0000000 0.9911869 1.9116612 0.4746387 
## Number of Observations: 2026
## Number of Groups: 
##         g id %in% g 
##         1      1000</code></pre>
<p>We can formally compare the models, and the second model wins.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="generalized-additive-mixed-models.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1<span class="sc">$</span>lme, mod2<span class="sc">$</span>lme)</span></code></pre></div>
<pre><code>##          Model df      AIC      BIC    logLik   Test  L.Ratio p-value
## mod1$lme     1  8 7594.727 7639.637 -3789.363                        
## mod2$lme     2 11 7171.059 7232.811 -3574.530 1 vs 2 429.6675  &lt;.0001</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-fjell2010" class="csl-entry">
Fjell, Anders. M., Kristine B. Walhovd, Lars T. Westlye, Ylva Østby, Christian K. Tamnes, Terry L. Jernigan, Anthony Gamst, and Anders M. Dale. 2010. <span>“When Does Brain Aging Accelerate? <span>Dangers</span> of Quadratic Fits in Cross-Sectional Studies.”</span> <em>NeuroImage</em> 50 (4): 1376–83. <a href="https://doi.org/10.1016/j.neuroimage.2010.01.061">https://doi.org/10.1016/j.neuroimage.2010.01.061</a>.
</div>
<div id="ref-sorensen2021" class="csl-entry">
Sørensen, Øystein, Kristine B. Walhovd, and Anders M. Fjell. 2021. <span>“A Recipe for Accurate Estimation of Lifespan Brain Trajectories, Distinguishing Longitudinal and Cohort Effects.”</span> <em>NeuroImage</em> 226 (February): 117596. <a href="https://doi.org/10.1016/j.neuroimage.2020.117596">https://doi.org/10.1016/j.neuroimage.2020.117596</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-intro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
